name: Deploy â€” Fast & No Composer

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted
    defaults:
      run:
        shell: powershell

    steps:
      - name: Checkout latest code
        uses: actions/checkout@v4

      # Update code inside container project directory
      - name: Sync code into running container (no down, no vendor install)
        run: |
          docker compose exec -T app powershell -Command "
            Copy-Item -Recurse -Force C:\actions-runner\_work\onstru_docker\onstru_docker\* C:\var\www\html\
          "

      - name: Restart application containers
        run: docker compose restart app nginx

      - name: Migrate & clear cache
        run: |
          docker compose exec -T app php artisan migrate --force
          docker compose exec -T app php artisan optimize:clear

      - name: Done
        run: Write-Host "ðŸš€ Deployed instantly â€” http://localhost:8000" -ForegroundColor Green
